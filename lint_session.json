npx : (node:20152) E
SLintIgnoreWarning: 
The ".eslintignore" 
file is no longer su
pported. Switch to u
sing the "ignores" p
roperty in "eslint.c
onfig.js": https://e
slint.org/docs/lates
t/use/configure/migr
ation-guide#ignoring
-files
위치 줄:1 문자:1
+ npx eslint src/typ
es/notificationEvent
s.ts src/services/no
tificationS ...
+ ~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~
    + CategoryInfo  
            : NotS  
  pecified: ((nod   
 e:20152) ES...#    
ignoring-files:    S
tring) [], Rem    ot
eException
    + FullyQualifie 
   dErrorId : Nati  
  veCommandError
 
(Use `node --trace-w
arnings ...` to show
 where the warning w
as created)
[{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\app\\admin\\push\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLogs'. Either include it or remove the dependency array.","line":51,"column":8,"nodeType":"ArrayExpression","endLine":51,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchLogs]","fix":{"range":[2285,2287],"text":"[fetchLogs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { createClient } from '@/lib/supabase-client';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Send, Loader2, Bell, TestTube } from 'lucide-react';\r\nimport { notificationService } from '@/services/notificationService';\r\nimport { NotificationEventType } from '@/types/notificationEvents';\r\nimport { toast } from 'sonner';\r\n\r\ninterface NotificationLog {\r\n    id: string;\r\n    category: string;\r\n    title: string;\r\n    body: string;\r\n    status: string;\r\n    created_at: string;\r\n    event_type?: string;\r\n}\r\n\r\n// ?대깽??????듭뀡 (?뚯뒪?몄슜)\r\nconst EVENT_OPTIONS = [\r\n    { value: NotificationEventType.RESERVATION_CONFIRMED, label: '?덉빟 ?뺤젙 (?몄떆 O)', push: true },\r\n    { value: NotificationEventType.DEPOSIT_CONFIRMED, label: '?낃툑 ?뺤씤 (?몄떆 O)', push: true },\r\n    { value: NotificationEventType.UPCOMING_STAY_D1, label: 'D-1 ?덈궡 (?몄떆 O)', push: true },\r\n    { value: NotificationEventType.WAITLIST_SLOT_OPENED, label: '鍮덉옄由??뚮┝ (?몄떆 O)', push: true },\r\n    { value: NotificationEventType.COMMUNITY_LIKE, label: '而ㅻ??덊떚 醫뗭븘??(諛곗?留?', push: false },\r\n    { value: NotificationEventType.COMMUNITY_COMMENT, label: '而ㅻ??덊떚 ?볤? (諛곗?留?', push: false },\r\n    { value: NotificationEventType.MISSION_REWARD, label: '誘몄뀡 蹂댁긽 (諛곗?留?', push: false },\r\n];\r\n\r\nexport default function AdminPushPage() {\r\n    const supabase = createClient();\r\n    const [title, setTitle] = useState('');\r\n    const [body, setBody] = useState('');\r\n    const [category, setCategory] = useState({ value: 'system', label: '?쒖뒪??(System)' });\r\n    const [target, setTarget] = useState('all');\r\n    const [sending, setSending] = useState(false);\r\n    const [logs, setLogs] = useState<NotificationLog[]>([]);\r\n\r\n    // ?대깽???뚯뒪?몄슜 ?곹깭\r\n    const [testEventType, setTestEventType] = useState<NotificationEventType>(NotificationEventType.RESERVATION_CONFIRMED);\r\n    const [testLoading, setTestLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchLogs();\r\n    }, []);\r\n\r\n    const fetchLogs = async () => {\r\n        const { data } = await supabase\r\n            .from('notifications')\r\n            .select('*')\r\n            .order('created_at', { ascending: false })\r\n            .limit(20);\r\n        if (data) setLogs(data);\r\n    };\r\n\r\n    // 湲곗〈 ?섎룞 諛쒖넚\r\n    const handleSend = async () => {\r\n        if (!title || !body) return;\r\n        setSending(true);\r\n\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n\r\n            await supabase.from('notifications').insert({\r\n                user_id: user?.id,\r\n                category: category.value,\r\n                title,\r\n                body,\r\n                status: 'queued'\r\n            });\r\n\r\n            setTitle('');\r\n            setBody('');\r\n            fetchLogs();\r\n            toast.success('?뚮┝??諛쒖넚 ?湲곗뿴???깅줉?섏뿀?듬땲??');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('諛쒖넚 ?ㅽ뙣');\r\n        } finally {\r\n            setSending(false);\r\n        }\r\n    };\r\n\r\n    // ?대깽??湲곕컲 ?뚮┝ ?뚯뒪??r\n    const handleEventTest = async () => {\r\n        setTestLoading(true);\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                toast.error('濡쒓렇?몄씠 ?꾩슂?⑸땲??');\r\n                return;\r\n            }\r\n\r\n            // ?뚯뒪???곗씠??r\n            const testData: Record<string, string> = {\r\n                siteName: '?뷀뼢?대꽕',\r\n                checkIn: '2026-01-10',\r\n                checkOut: '2026-01-12',\r\n                checkInTime: '14:00',\r\n                targetDate: '2026-01-15',\r\n                userName: '?뚯뒪?몄쑀?',\r\n                preview: '?뺣쭚 醫뗭? 湲?댁뿉??',\r\n                reward: '100',\r\n                message: '?뚯뒪??硫붿떆吏?낅땲??',\r\n                status: '諛곗넚以?,\r\n            };\r\n\r\n            const result = await notificationService.dispatchNotification(\r\n                testEventType,\r\n                user.id,\r\n                testData\r\n            );\r\n\r\n            if (result.success) {\r\n                toast.success(`?뚮┝ 諛쒖넚 ?꾨즺 (諛⑹떇: ${result.method === 'push' ? '?몄떆' : '?몄빋 諛곗?'})`);\r\n                fetchLogs();\r\n            } else {\r\n                toast.error(`諛쒖넚 ?ㅽ뙣: ${result.message}`);\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('?뚯뒪???ㅽ뙣');\r\n        } finally {\r\n            setTestLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h1 className=\"text-2xl font-bold\">?뚮┝ ?쇳꽣 (Notification Center)</h1>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                {/* Send Form */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle>?뚮┝ 諛쒖넚 (Broadcast)</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">移댄뀒怨좊━</label>\r\n                            <Select\r\n                                value={category.value}\r\n                                onValueChange={(val) => setCategory({ value: val, label: val })}\r\n                            >\r\n                                <SelectTrigger><SelectValue /></SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"system\">?쒖뒪??(System)</SelectItem>\r\n                                    <SelectItem value=\"reservation\">?덉빟 (Reservation)</SelectItem>\r\n                                    <SelectItem value=\"event\">?대깽??(Event)</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">?섏떊 ???(Segment)</label>\r\n                            <Select value={target} onValueChange={setTarget}>\r\n                                <SelectTrigger><SelectValue /></SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">?꾩껜 ?ъ슜??(All Users)</SelectItem>\r\n                                    <SelectItem value=\"test\">?뚯뒪??(?섏뿉寃뚮쭔)</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">?쒕ぉ</label>\r\n                            <Input value={title} onChange={(e) => setTitle(e.target.value)} placeholder=\"?뚮┝ ?쒕ぉ\" />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">?댁슜</label>\r\n                            <Textarea value={body} onChange={(e) => setBody(e.target.value)} placeholder=\"?뚮┝ ?댁슜\" rows={4} />\r\n                        </div>\r\n\r\n                        <Button className=\"w-full bg-[#1C4526]\" onClick={handleSend} disabled={sending}>\r\n                            {sending ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <Send className=\"w-4 h-4 mr-2\" />}\r\n                            諛쒖넚 ???깅줉\r\n                        </Button>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Queue Log */}\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle>理쒓렐 諛쒖넚 濡쒓렇 (Queue)</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"space-y-4\">\r\n                            {logs.length === 0 ? (\r\n                                <p className=\"text-gray-500 text-sm\">湲곕줉???놁뒿?덈떎.</p>\r\n                            ) : (\r\n                                logs.map(log => (\r\n                                    <div key={log.id} className=\"border-b pb-4 last:border-0\">\r\n                                        <div className=\"flex justify-between items-start mb-1\">\r\n                                            <span className={`text-xs font-bold px-2 py-0.5 rounded ${log.category === 'system' ? 'bg-gray-100 text-gray-700' : 'bg-green-100 text-green-700'}`}>\r\n                                                {log.category.toUpperCase()}\r\n                                            </span>\r\n                                            <span className=\"text-xs text-gray-400\">\r\n                                                {new Date(log.created_at).toLocaleString()}\r\n                                            </span>\r\n                                        </div>\r\n                                        <h4 className=\"font-medium text-sm\">{log.title}</h4>\r\n                                        <p className=\"text-xs text-gray-600 line-clamp-2\">{log.body}</p>\r\n                                        <div className=\"mt-2 flex items-center gap-2\">\r\n                                            <span className={`text-[10px] uppercase font-bold ${log.status === 'sent' ? 'text-blue-500' : 'text-orange-500'}`}>\r\n                                                {log.status}\r\n                                            </span>\r\n                                            {log.event_type && (\r\n                                                <span className=\"text-[10px] text-gray-400\">[{log.event_type}]</span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            )}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* ?대깽??湲곕컲 ?뚮┝ ?뚯뒪???뱀뀡 */}\r\n            <Card className=\"border-2 border-dashed border-brand-1/30\">\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <TestTube className=\"w-5 h-5 text-brand-1\" />\r\n                        ?대깽??湲곕컲 ?뚮┝ ?뚯뒪??r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                        SSOT ?뺤콉???곕Ⅸ ?먮룞 ?뚮┝ ?쒖뒪?쒖쓣 ?뚯뒪?명빀?덈떎.\r\n                        ?몄떆 ?덉슜 ?대깽?몃뒗 ?몄떆+諛곗?媛 ?앹꽦?섍퀬, ?몄떆 湲덉? ?대깽?몃뒗 諛곗?留??앹꽦?⑸땲??\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex flex-col md:flex-row gap-4 items-end\">\r\n                        <div className=\"flex-1 space-y-2\">\r\n                            <label className=\"text-sm font-medium\">?대깽?????/label>\r\n                            <Select\r\n                                value={testEventType}\r\n                                onValueChange={(val) => setTestEventType(val as NotificationEventType)}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {EVENT_OPTIONS.map((opt) => (\r\n                                        <SelectItem key={opt.value} value={opt.value}>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                {opt.push ? (\r\n                                                    <Bell className=\"w-3 h-3 text-green-500\" />\r\n                                                ) : (\r\n                                                    <span className=\"w-2 h-2 rounded-full bg-orange-400\" />\r\n                                                )}\r\n                                                {opt.label}\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <Button\r\n                            onClick={handleEventTest}\r\n                            disabled={testLoading}\r\n                            className=\"bg-brand-1 hover:bg-brand-1/90\"\r\n                        >\r\n                            {testLoading ? (\r\n                                <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n                            ) : (\r\n                                <TestTube className=\"w-4 h-4 mr-2\" />\r\n                            )}\r\n                            ?뚯뒪??諛쒖넚\r\n                        </Button>\r\n                    </div>\r\n                    <div className=\"mt-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-600\">\r\n                        <p className=\"font-medium mb-1\">?뮕 ?뚯뒪???덈궡</p>\r\n                        <ul className=\"list-disc list-inside space-y-0.5\">\r\n                            <li><span className=\"text-green-600 font-medium\">?몄떆 O</span>: notifications ?뚯씠釉?+ in_app_badges ?뚯씠釉붿뿉 湲곕줉</li>\r\n                            <li><span className=\"text-orange-600 font-medium\">諛곗?留?/span>: in_app_badges ?뚯씠釉붿뿉留?湲곕줉 (?섎떒 ?ㅻ퉬??鍮④컙 dot ?쒖떆)</li>\r\n                            <li>議곗슜?쒓컙(22:00~08:00)?먮뒗 ?쇰? ?몄떆媛 諛곗?濡??泥대맗?덈떎.</li>\r\n                        </ul>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\components\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\components\\reservation\\WaitlistButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\hooks\\useInAppBadge.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'fetchBadgesDirect'. Either include it or remove the dependency array.","line":68,"column":8,"nodeType":"ArrayExpression","endLine":68,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchBadgesDirect, supabase]","fix":{"range":[1847,1857],"text":"[fetchBadgesDirect, supabase]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\n/**\r\n * ?몄빋 諛곗? 愿由???r\n * ??퀎 ?뚮┝ 諛곗? 媛쒖닔 議고쉶 諛??쎌쓬 泥섎━\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { createClient } from '@/lib/supabase-client';\r\n\r\nexport interface BadgeCounts {\r\n    home: number;\r\n    reservation: number;\r\n    community: number;\r\n    myspace: number;\r\n    total: number;\r\n}\r\n\r\nconst DEFAULT_BADGES: BadgeCounts = {\r\n    home: 0,\r\n    reservation: 0,\r\n    community: 0,\r\n    myspace: 0,\r\n    total: 0,\r\n};\r\n\r\nexport function useInAppBadge() {\r\n    const [badges, setBadges] = useState<BadgeCounts>(DEFAULT_BADGES);\r\n    const [loading, setLoading] = useState(true);\r\n    const supabase = createClient();\r\n\r\n    // 諛곗? 媛쒖닔 議고쉶\r\n    const fetchBadges = useCallback(async () => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) {\r\n                setBadges(DEFAULT_BADGES);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            // RPC ?⑥닔 ?몄텧\r\n            const { data, error } = await supabase.rpc('get_badge_counts', {\r\n                p_user_id: user.id,\r\n            });\r\n\r\n            if (error) {\r\n                console.error('[useInAppBadge] Fetch error:', error);\r\n                // RPC媛 ?놁쑝硫?吏곸젒 荑쇰━\r\n                await fetchBadgesDirect(user.id);\r\n                return;\r\n            }\r\n\r\n            if (data) {\r\n                setBadges({\r\n                    home: data.home || 0,\r\n                    reservation: data.reservation || 0,\r\n                    community: data.community || 0,\r\n                    myspace: data.myspace || 0,\r\n                    total: data.total || 0,\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error('[useInAppBadge] Exception:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [supabase]);\r\n\r\n    // RPC ?놁쓣 ??吏곸젒 荑쇰━ (?대갚)\r\n    const fetchBadgesDirect = async (userId: string) => {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('in_app_badges')\r\n                .select('badge_target')\r\n                .eq('user_id', userId)\r\n                .eq('is_read', false);\r\n\r\n            if (error) {\r\n                console.error('[useInAppBadge] Direct query error:', error);\r\n                return;\r\n            }\r\n\r\n            const counts: BadgeCounts = { ...DEFAULT_BADGES };\r\n            data?.forEach((badge) => {\r\n                const target = badge.badge_target as keyof Omit<BadgeCounts, 'total'>;\r\n                if (counts[target] !== undefined) {\r\n                    counts[target]++;\r\n                    counts.total++;\r\n                }\r\n            });\r\n\r\n            setBadges(counts);\r\n        } catch (err) {\r\n            console.error('[useInAppBadge] Direct query exception:', err);\r\n        }\r\n    };\r\n\r\n    // ?뱀젙 ??諛곗? ?쎌쓬 泥섎━\r\n    const markAsRead = useCallback(async (target: 'home' | 'reservation' | 'community' | 'myspace') => {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            // RPC ?⑥닔 ?몄텧\r\n            const { error } = await supabase.rpc('mark_badges_as_read', {\r\n                p_user_id: user.id,\r\n                p_target: target,\r\n            });\r\n\r\n            if (error) {\r\n                // RPC ?놁쑝硫?吏곸젒 ?낅뜲?댄듃\r\n                await supabase\r\n                    .from('in_app_badges')\r\n                    .update({ is_read: true })\r\n                    .eq('user_id', user.id)\r\n                    .eq('badge_target', target)\r\n                    .eq('is_read', false);\r\n            }\r\n\r\n            // 濡쒖뺄 ?곹깭 利됱떆 ?낅뜲?댄듃\r\n            setBadges((prev) => ({\r\n                ...prev,\r\n                [target]: 0,\r\n                total: Math.max(0, prev.total - prev[target]),\r\n            }));\r\n        } catch (err) {\r\n            console.error('[useInAppBadge] Mark as read exception:', err);\r\n        }\r\n    }, [supabase]);\r\n\r\n    // 珥덇린 濡쒕뱶\r\n    useEffect(() => {\r\n        fetchBadges();\r\n    }, [fetchBadges]);\r\n\r\n    // ?ㅼ떆媛?援щ룆 (?좏깮 ?ы빆)\r\n    useEffect(() => {\r\n        const channel = supabase\r\n            .channel('badge-changes')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'in_app_badges',\r\n                },\r\n                () => {\r\n                    // 蹂寃???諛곗? ?ㅼ떆 議고쉶\r\n                    fetchBadges();\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [supabase, fetchBadges]);\r\n\r\n    return {\r\n        badges,\r\n        loading,\r\n        fetchBadges,\r\n        markAsRead,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\services\\notificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\USER\\Desktop\\RAON.I\\src\\types\\notificationEvents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
