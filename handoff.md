# ì„¸ì…˜ ì¸ìˆ˜ì¸ê³„ ë¬¸ì„œ (Handoff)
**ë‚ ì§œ**: 2026-01-12  
**ì„¸ì…˜ ID**: 16c1d8f4-3b2e-42d5-ac33-e2cf203827ea

---

## ğŸ“‹ í˜„ì¬ ìƒíƒœ ìš”ì•½

### âœ… ì™„ë£Œëœ ì‘ì—…

| í•­ëª© | ì„¤ëª… |
|------|------|
| **ì˜ˆì•½ ì·¨ì†Œ/í™˜ë¶ˆ ì‹œìŠ¤í…œ** | ì‚¬ìš©ì ì·¨ì†Œ ìš”ì²­ â†’ ê´€ë¦¬ì í™˜ë¶ˆ ì²˜ë¦¬ ì „ì²´ í”Œë¡œìš° êµ¬í˜„ |
| **í™˜ë¶ˆ ì •ì±… ì ìš©** | D-7 100% ~ D-Day 0% í™˜ë¶ˆìœ¨ ì •ì±… êµ¬í˜„ |
| **ì‚¬ìš©ì ì˜ˆì•½ ë‚´ì—­ í˜ì´ì§€** | `/myspace/reservations` - ì „ì²´ ì˜ˆì•½ ì¡°íšŒ ë° ì·¨ì†Œ ìš”ì²­ |
| **ê´€ë¦¬ì í™˜ë¶ˆ ì²˜ë¦¬ UI** | í™˜ë¶ˆëŒ€ê¸° íƒ­ + í™˜ë¶ˆì™„ë£Œ ë²„íŠ¼ ì¶”ê°€ |

---

## ğŸ”§ ê¸°ìˆ ì  ê²°ì • ì‚¬í•­

### 1. ì˜ˆì•½ ì·¨ì†Œ/í™˜ë¶ˆ ì‹œìŠ¤í…œ
- **DB êµ¬ì¡°**: `reservations` í…Œì´ë¸”ì— í™˜ë¶ˆ ê´€ë ¨ ì»¬ëŸ¼ 6ê°œ ì¶”ê°€
  - `refund_bank`, `refund_account`, `refund_holder`, `cancel_reason`
  - `refund_amount`, `refund_rate`, `cancelled_at`, `refunded_at`
- **ìƒˆ ìƒíƒœ**: `REFUND_PENDING` (í™˜ë¶ˆëŒ€ê¸°) ì¶”ê°€
- **RPC í•¨ìˆ˜**: 
  - `request_reservation_cancel` - ì‚¬ìš©ì ì·¨ì†Œ ìš”ì²­
  - `complete_reservation_refund` - ê´€ë¦¬ì í™˜ë¶ˆ ì™„ë£Œ
  - `get_my_reservations` - ë³¸ì¸ ì˜ˆì•½ ëª©ë¡
  - `calculate_refund_rate` - í™˜ë¶ˆìœ¨ ê³„ì‚°

### 2. í™˜ë¶ˆ ì •ì±… (í•˜ë“œì½”ë”©)
```
D-7 ì´ìƒ: 100%
D-6: 90%
D-5: 50%
D-4: 40%
D-3: 30%
D-2: 20%
D-1/ë‹¹ì¼: 0%
```

### 3. ì€í–‰ ëª©ë¡
- 16ê°œ ì£¼ìš” ì€í–‰ í•˜ë“œì½”ë”© (ì¹´ì¹´ì˜¤ë±…í¬, í† ìŠ¤ë±…í¬, KBêµ­ë¯¼ ë“±)
- "ì§ì ‘ì…ë ¥" ì˜µì…˜ìœ¼ë¡œ ê¸°íƒ€ ì€í–‰ ëŒ€ì‘

---

## ğŸ“Œ ë‹¤ìŒ ì‘ì—… ê°€ì´ë“œ

### ìš°ì„ ìˆœìœ„ ë†’ìŒ
1. **í”„ë¡œë•ì…˜ DB ë§ˆì´ê·¸ë ˆì´ì…˜**: ì•„ë˜ SQL íŒŒì¼ ì‹¤í–‰ í•„ìš”
   - `20260112_reservation_cancellation.sql` â† **ì´ë²ˆ ì„¸ì…˜**
   - `20260111_reservation_concurrency.sql`
   - `20260111_admin_delete_permissions.sql`

### ìš°ì„ ìˆœìœ„ ë³´í†µ
2. **ë¸Œë¼ìš°ì € í†µí•© í…ŒìŠ¤íŠ¸**: ì˜ˆì•½ â†’ ì·¨ì†Œ ìš”ì²­ â†’ ê´€ë¦¬ì í™˜ë¶ˆ í”Œë¡œìš° ê²€ì¦
3. **í‘¸ì‹œ ì•Œë¦¼ ì—°ë™**: ì·¨ì†Œ ìš”ì²­/í™˜ë¶ˆ ì™„ë£Œ ì‹œ ì•Œë¦¼ ë°œì†¡

---

## âš ï¸ ì£¼ì˜ ì‚¬í•­

1. **SQL ë§ˆì´ê·¸ë ˆì´ì…˜**: ìœ„ íŒŒì¼ë“¤ í”„ë¡œë•ì…˜ DBì— ë°˜ë“œì‹œ ì‹¤í–‰
2. **í™˜ë¶ˆ ì •ì±… ë³€ê²½**: `calculate_refund_rate` í•¨ìˆ˜ ë° `refund.ts` ìˆ˜ì • í•„ìš”
3. **ì€í–‰ ëª©ë¡ ì¶”ê°€**: `refund.ts`ì˜ `KOREAN_BANKS` ë°°ì—´ì— ì¶”ê°€

---

## ğŸ“ ì£¼ìš” ìˆ˜ì • íŒŒì¼

```
src/
â”œâ”€â”€ types/reservation.ts           # REFUND_PENDING, REFUNDED ìƒíƒœ ì¶”ê°€
â”œâ”€â”€ constants/refund.ts            # [NEW] ì€í–‰ ëª©ë¡, í™˜ë¶ˆìœ¨ ê³„ì‚°
â”œâ”€â”€ store/useReservationStore.ts   # ì·¨ì†Œ/í™˜ë¶ˆ ì•¡ì…˜ 3ê°œ ì¶”ê°€
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ reservation/CancelReservationSheet.tsx  # [NEW] ì·¨ì†Œ ìš”ì²­ ë°”í…€ì‹œíŠ¸
â”‚   â”œâ”€â”€ admin/ReservationCard.tsx  # í™˜ë¶ˆ ì •ë³´ í‘œì‹œ + í™˜ë¶ˆì™„ë£Œ ë²„íŠ¼
â”‚   â””â”€â”€ myspace/UpcomingReservation.tsx  # ì˜ˆì•½ ë‚´ì—­ ë§í¬ ì¶”ê°€
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (mobile)/myspace/reservations/page.tsx  # [NEW] ì˜ˆì•½ ë‚´ì—­ í˜ì´ì§€
â”‚   â””â”€â”€ admin/reservations/page.tsx  # í™˜ë¶ˆëŒ€ê¸°/í™˜ë¶ˆì™„ë£Œ íƒ­ ì¶”ê°€

supabase/migrations/
â””â”€â”€ 20260112_reservation_cancellation.sql  # [NEW] í™˜ë¶ˆ ì‹œìŠ¤í…œ ìŠ¤í‚¤ë§ˆ
```
